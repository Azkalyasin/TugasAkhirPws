generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id            String   @id @default(uuid())
  name          String
  email         String   @unique
  password      String
  role          Role     @default(USER)
  apiKey        String?  @unique
  plan          Plan     @default(FREE)
  apiCalls      Int      @default(0)
  monthlyQuota  Int      @default(1000)
  dailyQuota    Int      @default(100)
  lastReset     DateTime @default(now())
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  
  apiUsage      ApiUsage[]
  
  @@index([email])
  @@index([apiKey])
}

model Stock {
  id            String   @id @default(uuid())
  symbol        String   @unique
  name          String
  sector        String?
  subsector     String?
  price         Float
  open          Float?
  high          Float?
  low           Float?
  close         Float?
  change        Float    @default(0)
  changePercent Float    @default(0)
  volume        BigInt   @default(0)
  value         BigInt   @default(0)
  marketCap     BigInt?
  shares        BigInt?
  foreignBuy    BigInt?
  foreignSell   BigInt?
  lastUpdate    DateTime @default(now())
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  
  history       StockHistory[]
  
  @@index([symbol])
  @@index([sector])
}

model StockHistory {
  id        String   @id @default(uuid())
  stockId   String
  stock     Stock    @relation(fields: [stockId], references: [id], onDelete: Cascade)
  date      DateTime
  open      Float
  high      Float
  low       Float
  close     Float
  volume    BigInt
  createdAt DateTime @default(now())
  
  @@unique([stockId, date])
  @@index([stockId, date])
}

model ApiUsage {
  id          String   @id @default(uuid())
  userId      String
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  endpoint    String
  method      String
  statusCode  Int
  timestamp   DateTime @default(now())
  
  @@index([userId, timestamp])
}

enum Role {
  ADMIN
  USER
}

enum Plan {
  FREE
  STARTER
  PRO
  ENTERPRISE
}